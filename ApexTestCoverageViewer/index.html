<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Apex Test Coverage Viewer</title>
  <link rel="stylesheet" href="../assets/css/styles.css?v=108">
  <style id="apex-scoped">
#apex-app{
      --bg:#0f1115; --panel:#151821; --muted:#9aa4b2; --text:#e8ecf1; --accent:#4aa3ff; --danger:#ff5b5b;
      --ok:#2fd47a; --border:#242939;
    }
#apex-app html,#apex-app body{margin:0;padding:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
#apex-app h1{font-size:18px;margin:12px 0}
#apex-app .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
#apex-app .grid{display:grid;grid-template-columns:1.2fr 2fr;gap:16px}
#apex-app .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:0 2px 20px rgba(0,0,0,.25)}
#apex-app .card header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px}
#apex-app .card header h2{margin:0;font-size:15px}
#apex-app .card .body{padding:12px 14px}
#apex-app textarea{width:100%;min-height:180px;resize:vertical;background:#0b0d12;color:var(--text);border:1px solid var(--border);border-radius:8px;padding:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
#apex-app pre{background:#0b0f18;border:1px solid var(--border);border-radius:8px;padding:10px;overflow:auto}
#apex-app code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
#apex-app .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0}
#apex-app input[type="text"],#apex-app input[type="url"],#apex-app input[type="number"],#apex-app input[type="password"]{flex:1 1 220px;padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
#apex-app button{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#101626;color:var(--text);cursor:pointer}
#apex-app button.primary{background:linear-gradient(180deg,#1a66ff,#1247b8);border-color:#0f2f7a}
#apex-app button.ghost{background:#101318}
#apex-app button:disabled{opacity:.6;cursor:not-allowed}
#apex-app select{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
#apex-app table{width:100%;border-collapse:separate;border-spacing:0 8px}
#apex-app thead th{font-size:12px;color:var(--muted);text-align:left;padding:6px 10px}
#apex-app tbody tr{background:#0b0f18;border:1px solid var(--border);transition:transform .06s ease}
#apex-app tbody tr:hover{transform:translateY(-1px)}
#apex-app td{padding:10px}
#apex-app .num{font-variant-numeric:tabular-nums;text-align:right}
#apex-app .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);background:#0f1320}
#apex-app .pct-ok .badge{background:rgba(47,212,122,.12);border-color:rgba(47,212,122,.35);color:var(--ok)}
#apex-app .pct-bad{outline:1px solid rgba(255,91,91,.35);background:linear-gradient(180deg,rgba(255,91,91,.08),transparent)}
#apex-app .pct-bad .badge{background:rgba(255,91,91,.12);border-color:rgba(255,91,91,.35);color:var(--danger)}
#apex-app .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
#apex-app .muted{color:var(--muted)}
#apex-app .sticky{position:sticky;top:0;background:var(--panel);z-index:2;border-bottom:1px solid var(--border)}
#apex-app .small{font-size:12px}
#apex-app .checkbox{width:18px;height:18px}
#apex-app .pill{border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:#0b0f18}
#apex-app .totals{display:flex;gap:10px;flex-wrap:wrap}
#apex-app .totals .pill strong{color:var(--accent)}
#apex-app .hint{font-size:12px;color:var(--muted);margin-top:6px}
#apex-app .footer-note{margin-top:8px;color:var(--muted);font-size:12px}
#apex-app code.k{background:#0b0f18;border:1px solid var(--border);padding:1px 6px;border-radius:6px}
#apex-app .warn{color:#ffd479}
#apex-app .api-box{border:1px dashed var(--border);border-radius:10px;padding:10px;background:#0b0f18}
#apex-app details.examples summary{cursor:pointer;user-select:none}
#apex-app .example-bar{display:flex;gap:8px;align-items:center;margin:8px 0}
  </style>
  
<style>#apex-app{position:relative!important;z-index:0!important}</style>

  <script>
  (function(){
    var v='v1.0.10';
    function forceBoot(){
      if (document.querySelector('header')) return;
      var h=document.createElement('header');
      h.innerHTML = '<div class="container" style="display:flex;align-items:center;gap:16px">'
        + '<div class="brand"><a href="../versions.html" class="badge">v1.0.10</a><span id="title">Various Apps</span></div>'
        + '<div class="controls"><div class="toolbar">'
        +   '<button class="iconbtn back-btn" data-action="back" title="Back"><span>←</span><span>Back</span></button>'
        +   '<a class="iconbtn" href="mailto:diego.almeida@dhalmeida.com" title="Contact"><span>Contact</span></a>'
        + '</div></div></div>';
      document.body.prepend(h);
      var f=document.createElement('footer');
      f.innerHTML = '<div class="container"><div class="footgrid"><div><h4>About</h4>'
        + '<div class="kvs"><div class="row"><span class="key">Version</span><span class="val"><a href="../versions.html">v1.0.10</a></span></div></div></div>'
        + '<div><h4>Contact</h4><div class="kvs"><div class="row"><span class="key">Email</span><span class="val"><a href="mailto:diego.almeida@dhalmeida.com">diego.almeida@dhalmeida.com</a></span></div></div></div></div>'
        + '<div class="copyright">© <span class="sig">By Dhalmeida</span>. All rights reserved.</div></div>';
      document.body.appendChild(f);
      var backBtn = h.querySelector('.back-btn');
      if(backBtn){ backBtn.addEventListener('click', function(){ try{ if(document.referrer && document.referrer!==location.href){ history.back(); return; } }catch(e){} location.href='../index.html'; }); }
    }
    var s=document.createElement('script');
    s.src='../assets/js/app.js?v=110'; s.defer=true;
    s.onload=function(){ if(window.WT && WT.init){ try{ WT.init(); }catch(e){} } else { forceBoot(); } };
    s.onerror=function(){ forceBoot(); };
    document.head.appendChild(s);
  })();
  </script>


  <!-- v1.0.10 chrome loader (force parent assets) -->
  <style>header{position:sticky;top:0;z-index:2147483000}footer{position:relative;z-index:2147482000}body>main{min-height:calc(100vh - 56px - 64px)}</style>
  <script>
  (function(){
    function boot(){
      if (window.WT && WT.init){ try{ WT.init(); }catch(e){} return; }
      // emergency header/footer
      if (document.querySelector('header')) return;
      var h=document.createElement('header');
      h.innerHTML='<div class="container" style="display:flex;align-items:center;gap:16px">'
        +'<div class="brand"><a href="../versions.html" class="badge">v1.0.10</a><span id="title">Various Apps</span></div>'
        +'<div class="controls"><div class="toolbar">'
        +'<button class="iconbtn back-btn" data-action="back" title="Back"><span>←</span><span>Back</span></button>'
        +'<a class="iconbtn" href="mailto:diego.almeida@dhalmeida.com" title="Contact"><span>Contact</span></a>'
        +'</div></div></div>';
      document.body.prepend(h);
      var f=document.createElement('footer');
      f.innerHTML='<div class="container"><div class="copyright">© <span class="sig">By Dhalmeida</span>. All rights reserved.</div></div>';
      document.body.appendChild(f);
      var b=h.querySelector('.back-btn'); if(b){ b.addEventListener('click', function(){ location.href='../index.html'; }); }
    }
    var s=document.createElement('script'); s.defer=true; s.src='../assets/js/app.js?v=110';
    s.onload=boot; s.onerror=boot; document.head.appendChild(s);
    setTimeout(boot, 300); // last resort
  })();
  </script>

<style id="v111-hide-apex">body>main{display:none!important}</style>
</head>
<body>
  <main>
    <div id="apex-app">
<div class="wrap">
    <h1>Apex Test Coverage Viewer</h1>

    <div class="grid">
      <!-- Input panel -->
      <section class="card">
        <header><h2>Data input</h2></header>
        <div class="body">
          <div class="row">
            <label for="source">Source:</label>
            <select id="source">
              <option value="paste" selected>Paste (JSON / CSV / TSV)</option>
              <option value="api">Salesforce Tooling API (manual auth required)</option>
            </select>
          </div>

          <!-- Paste mode -->
          <div id="pasteBox">
            <div class="row">
              <button id="btnLoad" class="primary">Load Data</button>
              <button id="btnSample" class="ghost">Sample</button>
              <span class="muted small">Expected fields: <code class="k">ApexClassOrTrigger.Name</code>, <code class="k">NumLinesCovered</code>, <code class="k">NumLinesUncovered</code></span>
            </div>
            <textarea id="inputRaw" placeholder='Paste JSON, CSV, or TSV here.'></textarea>

            <!-- Examples block with Tooling API SOQL -->
            <details class="examples" style="margin-top:10px">
              <summary>Input examples and Tooling API SOQL</summary>

              <div class="example-bar">
                <strong>JSON</strong>
                <button class="ghost" data-copy="#ex-json">Copy</button>
                <button class="ghost" data-fill="#ex-json">Fill textarea</button>
              </div>
              <pre id="ex-json"><code>[
  {"ApexClassOrTrigger.Name":"AccountTrigger","NumLinesCovered":5,"NumLinesUncovered":1},
  {"ApexClassOrTrigger.Name":"AccountUtils","NumLinesCovered":92,"NumLinesUncovered":446}
]</code></pre>

              <div class="example-bar">
                <strong>CSV</strong>
                <button class="ghost" data-copy="#ex-csv">Copy</button>
                <button class="ghost" data-fill="#ex-csv">Fill textarea</button>
              </div>
              <pre id="ex-csv"><code>ApexClassOrTrigger.Name,NumLinesCovered,NumLinesUncovered
AccountTrigger,5,1
AccountUtils,92,446</code></pre>

              <div class="example-bar">
                <strong>TSV</strong>
                <button class="ghost" data-copy="#ex-tsv">Copy</button>
                <button class="ghost" data-fill="#ex-tsv">Fill textarea</button>
              </div>
              <pre id="ex-tsv"><code>ApexClassOrTrigger.Name	NumLinesCovered	NumLinesUncovered
AccountTrigger	5	1
AccountUtils	92	446</code></pre>

              <div class="example-bar">
                <strong>Tooling API SOQL</strong>
                <button class="ghost" data-copy="#ex-soql">Copy</button>
              </div>
              <pre id="ex-soql"><code>SELECT ApexClassOrTrigger.Name, NumLinesCovered, NumLinesUncovered
FROM ApexCodeCoverageAggregate</code></pre>

              <div class="hint">
                <span class="warn">Important:</span> run the SOQL in **Tooling API** context and paste the exported result (JSON/CSV/TSV) above,
                or switch to the Tooling API mode and provide a valid token. Example CLI:
                <code class="k">sfdx force:data:soql:query -t -q "SELECT ApexClassOrTrigger.Name, NumLinesCovered, NumLinesUncovered FROM ApexCodeCoverageAggregate" --json</code>
              </div>
            </details>
          </div>

          <!-- API mode -->
          <div id="apiBox" class="api-box" style="display:none">
            <div class="row">
              <input id="instanceUrl" type="url" placeholder="Instance URL (e.g., https://yourDomain.my.salesforce.com)" />
            </div>
            <div class="row">
              <input id="apiVersion" type="number" min="30" max="99" step="1" value="61" style="max-width:140px" />
              <input id="accessToken" type="password" placeholder="Access Token (Bearer)" />
            </div>
            <div class="row">
              <input id="soql" type="text" value="SELECT ApexClassOrTrigger.Name, NumLinesCovered, NumLinesUncovered FROM ApexCodeCoverageAggregate" />
              <button id="btnRun" class="primary">Run Tooling Query</button>
            </div>
            <div class="hint">
              <span class="warn">Important:</span> you must provide a valid token and have CORS allowed for your origin.
              This runs a GET to <code class="k">/services/data/vXX.X/tooling/query/?q=...</code> with <code class="k">Authorization: Bearer &lt;token&gt;</code>.
            </div>
          </div>

          <div id="err" class="hint"></div>
        </div>
      </section>

      <!-- Main table -->
      <section class="card">
        <header class="sticky">
          <h2 style="flex:1">All results</h2>
          <div class="toolbar">
            <input type="text" id="search" placeholder="Search by name..." />
            <button id="selectVisible" class="ghost">Select visible</button>
            <button id="clearSelection" class="ghost">Clear selection</button>
          </div>
        </header>
        <div class="body">
          <div class="totals" id="totals"></div>
          <table id="mainTable">
            <thead>
              <tr>
                <th><input type="checkbox" id="checkAll" class="checkbox" title="Select all"/></th>
                <th>Class/Trigger</th>
                <th class="num">Covered</th>
                <th class="num">Uncovered</th>
                <th class="num">% Covered</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="footer-note">Rows with coverage below 80% are highlighted in red.</div>
        </div>
      </section>
    </div>

    <!-- Refined table -->
    <section class="card" style="margin-top:16px">
      <header>
        <h2 style="flex:1">Refined table (selected)</h2>
        <div class="toolbar">
          <button id="exportCsv" class="ghost">Export CSV</button>
          <span id="refinedTotals" class="muted small"></span>
        </div>
      </header>
      <div class="body">
        <table id="refinedTable">
          <thead>
            <tr>
              <th>Class/Trigger</th>
              <th class="num">Covered</th>
              <th class="num">Uncovered</th>
              <th class="num">% Covered</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

  </div>
    </div>
  </main>
  

</body>
</html>